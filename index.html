<!doctype html>
<html lang="vi" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tr√≤ Ch∆°i √în T·∫≠p H√¨nh H·ªçc</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    @keyframes celebrate {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .celebrate { animation: celebrate 0.5s ease-in-out; }
    .shake { animation: shake 0.3s ease-in-out; }
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    .timer-warning { animation: shake 0.5s ease-in-out infinite; }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full overflow-auto"></div>
  <script>
    const questions = [
      // NH·∫¨N BI·∫æT (10 c√¢u)
      {
        id: 1,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh thang c√¢n c√≥ t√≠nh ch·∫•t n√†o sau ƒë√¢y?",
        options: [
          "Hai c·∫°nh b√™n b·∫±ng nhau",
          "Hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau",
          "Hai g√≥c k·ªÅ m·ªôt ƒë√°y b·∫±ng nhau",
          "C·∫£ ba t√≠nh ch·∫•t tr√™n"
        ],
        correct: 3,
        explanation: "H√¨nh thang c√¢n c√≥ ƒë·∫ßy ƒë·ªß 3 t√≠nh ch·∫•t: hai c·∫°nh b√™n b·∫±ng nhau, hai ƒëÔøΩÔøΩÔøΩÔøΩ·ªùng ch√©o b·∫±ng nhau, v√† hai g√≥c k·ªÅ m·ªôt ƒë√°y b·∫±ng nhau.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><polygon points="50,30 150,30 170,110 30,110" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 2,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh b√¨nh h√†nh c√≥ bao nhi√™u c·∫∑p c·∫°nh song song?",
        options: ["1 c·∫∑p", "2 c·∫∑p", "3 c·∫∑p", "Kh√¥ng c√≥"],
        correct: 1,
        explanation: "H√¨nh b√¨nh h√†nh c√≥ 2 c·∫∑p c·∫°nh ƒë·ªëi song song v·ªõi nhau (AB // CD v√† AD // BC).",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="40,30 160,30 140,90 20,90" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 3,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh ch·ªØ nh·∫≠t c√≥ m·∫•y g√≥c vu√¥ng?",
        options: ["1 g√≥c", "2 g√≥c", "3 g√≥c", "4 g√≥c"],
        correct: 3,
        explanation: "H√¨nh ch·ªØ nh·∫≠t c√≥ 4 g√≥c vu√¥ng (m·ªói g√≥c ƒë·ªÅu b·∫±ng 90¬∞).",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 4,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh thoi c√≥ ƒë·∫∑c ƒëi·ªÉm g√¨ v·ªÅ c√°c c·∫°nh?",
        options: [
          "Hai c·∫°nh ƒë·ªëi b·∫±ng nhau",
          "B·ªën c·∫°nh b·∫±ng nhau",
          "Hai c·∫°nh k·ªÅ b·∫±ng nhau",
          "Kh√¥ng c√≥ c·∫°nh n√†o b·∫±ng nhau"
        ],
        correct: 1,
        explanation: "H√¨nh thoi c√≥ t·∫•t c·∫£ 4 c·∫°nh b·∫±ng nhau (AB = BC = CD = DA).",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><polygon points="100,20 170,70 100,120 30,70" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 5,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh vu√¥ng l√† h√¨nh c√≥:",
        options: [
          "B·ªën g√≥c vu√¥ng v√† b·ªën c·∫°nh b·∫±ng nhau",
          "Ch·ªâ c√≥ b·ªën g√≥c vu√¥ng",
          "Ch·ªâ c√≥ b·ªën c·∫°nh b·∫±ng nhau",
          "Hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c"
        ],
        correct: 0,
        explanation: "H√¨nh vu√¥ng v·ª´a c√≥ 4 g√≥c vu√¥ng v·ª´a c√≥ 4 c·∫°nh b·∫±ng nhau, l√† h√¨nh ƒë·∫∑c bi·ªát nh·∫•t trong c√°c tÔøΩÔøΩ gi√°c.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 6,
        level: "Nh·∫≠n bi·∫øt",
        question: "Trong h√¨nh thang c√¢n, hai g√≥c k·ªÅ m·ªôt ƒë√°y c√≥ quan h·ªá g√¨?",
        options: ["B·∫±ng nhau", "B√π nhau", "Ph·ª• nhau", "Kh√¥ng c√≥ quan h·ªá"],
        correct: 0,
        explanation: "Trong h√¨nh thang c√¢n, hai g√≥c k·ªÅ m·ªôt ƒë√°y lu√¥n b·∫±ng nhau (v√≠ d·ª•: ‚à†A = ‚à†B).",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="50,20 150,20 170,100 30,100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 7,
        level: "Nh·∫≠n bi·∫øt",
        question: "Hai ƒë∆∞·ªùng ch√©o c·ªßa h√¨nh b√¨nh h√†nh c√≥ t√≠nh ch·∫•t g√¨?",
        options: [
          "B·∫±ng nhau",
          "Vu√¥ng g√≥c v·ªõi nhau",
          "C·∫Øt nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng",
          "Song song v·ªõi nhau"
        ],
        correct: 2,
        explanation: "Hai ƒë∆∞·ªùng ch√©o c·ªßa h√¨nh b√¨nh h√†nh c·∫Øt nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng (OA = OC v√† OB = OD).",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="40,30 160,30 140,90 20,90" fill="none" stroke="currentColor" stroke-width="2"/><line x1="40" y1="30" x2="140" y2="90" stroke="#3b82f6" stroke-width="2"/><line x1="160" y1="30" x2="20" y2="90" stroke="#ef4444" stroke-width="2"/><circle cx="90" cy="60" r="4" fill="#10b981"/></svg>`
      },
      {
        id: 8,
        level: "Nh·∫≠n bi·∫øt",
        question: "H√¨nh ch·ªØ nh·∫≠t c√≥ hai ƒë∆∞·ªùng ch√©o:",
        options: [
          "B·∫±ng nhau",
          "Vu√¥ng g√≥c",
          "Song song",
          "Kh√¥ng c·∫Øt nhau"
        ],
        correct: 0,
        explanation: "H√¨nh ch·ªØ nh·∫≠t c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau (AC = BD) v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/><line x1="40" y1="30" x2="160" y2="90" stroke="#3b82f6" stroke-width="2"/><line x1="160" y1="30" x2="40" y2="90" stroke="#3b82f6" stroke-width="2"/><circle cx="100" cy="60" r="4" fill="#ef4444"/></svg>`
      },
      {
        id: 9,
        level: "Nh·∫≠n bi·∫øt",
        question: "Hai ƒë∆∞·ªùng ch√©o c·ªßa h√¨nh thoi c√≥ t√≠nh ch·∫•t g√¨?",
        options: [
          "B·∫±ng nhau",
          "Vu√¥ng g√≥c v·ªõi nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng",
          "Song song v·ªõi nhau",
          "Kh√¥ng c√≥ t√≠nh ch·∫•t ƒë·∫∑c bi·ªát"
        ],
        correct: 1,
        explanation: "Hai ƒë∆∞·ªùng ch√©o c·ªßa h√¨nh thoi vu√¥ng g√≥c v·ªõi nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><polygon points="100,20 170,70 100,120 30,70" fill="none" stroke="currentColor" stroke-width="2"/><line x1="100" y1="20" x2="100" y2="120" stroke="#3b82f6" stroke-width="2"/><line x1="30" y1="70" x2="170" y2="70" stroke="#ef4444" stroke-width="2"/><circle cx="100" cy="70" r="4" fill="#10b981"/></svg>`
      },
      {
        id: 10,
        level: "Nh·∫≠n bi·∫øt",
        question: "G√≥c c·ªßa h√¨nh vu√¥ng c√≥ s·ªë ƒëo b·∫±ng:",
        options: ["60¬∞", "80¬∞", "90¬∞", "120¬∞"],
        correct: 2,
        explanation: "T·∫•t c·∫£ c√°c g√≥c c·ªßa h√¨nh vu√¥ng ƒë·ªÅu l√† g√≥c vu√¥ng, c√≥ s·ªë ƒëo b·∫±ng 90¬∞.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },

      // TH√îNG HI·ªÇU (10 c√¢u)
      {
        id: 11,
        level: "Th√¥ng hi·ªÉu",
        question: "H√¨nh thang c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau th√¨ ƒë√≥ l√† h√¨nh g√¨?",
        options: [
          "H√¨nh thang th∆∞·ªùng",
          "H√¨nh thang c√¢n",
          "H√¨nh b√¨nh h√†nh",
          "Ch∆∞a ƒë·ªß ƒëi·ªÅu ki·ªán k·∫øt lu·∫≠n"
        ],
        correct: 1,
        explanation: "D·∫•u hi·ªáu nh·∫≠n bi·∫øt h√¨nh thang c√¢n: H√¨nh thang c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau l√† h√¨nh thang c√¢n.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="50,20 150,20 170,100 30,100" fill="none" stroke="currentColor" stroke-width="2"/><line x1="50" y1="20" x2="170" y2="100" stroke="#3b82f6" stroke-width="2" stroke-dasharray="3,3"/><line x1="150" y1="20" x2="30" y2="100" stroke="#3b82f6" stroke-width="2" stroke-dasharray="3,3"/></svg>`
      },
      {
        id: 12,
        level: "Th√¥ng hi·ªÉu",
        question: "T·ª© gi√°c c√≥ hai c·∫°nh ƒë·ªëi song song v√† b·∫±ng nhau l√†:",
        options: [
          "H√¨nh thang",
          "H√¨nh b√¨nh h√†nh",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi"
        ],
        correct: 1,
        explanation: "D·∫•u hi·ªáu nh·∫≠n bi·∫øt h√¨nh b√¨nh h√†nh: T·ª© gi√°c c√≥ hai c·∫°nh ƒë·ªëi song song v√† b·∫±ng nhau l√† h√¨nh b√¨nh h√†nh.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="40,30 160,30 140,90 20,90" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 13,
        level: "Th√¥ng hi·ªÉu",
        question: "H√¨nh b√¨nh h√†nh c√≥ m·ªôt g√≥c vu√¥ng th√¨ ƒë√≥ l√† h√¨nh g√¨?",
        options: [
          "H√¨nh thang c√¢n",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi",
          "H√¨nh vu√¥ng"
        ],
        correct: 1,
        explanation: "N·∫øu h√¨nh b√¨nh h√†nh c√≥ m·ªôt g√≥c vu√¥ng th√¨ c·∫£ 4 g√≥c ƒë·ªÅu vu√¥ng, do ƒë√≥ n√≥ l√† h√¨nh ch·ªØ nh·∫≠t.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 14,
        level: "Th√¥ng hi·ªÉu",
        question: "H√¨nh ch·ªØ nh·∫≠t c√≥ hai c·∫°nh k·ªÅ b·∫±ng nhau th√¨ ƒë√≥ l√†:",
        options: [
          "H√¨nh b√¨nh h√†nh",
          "H√¨nh thoi",
          "H√¨nh vu√¥ng",
          "H√¨nh thang c√¢n"
        ],
        correct: 2,
        explanation: "H√¨nh ch·ªØ nh·∫≠t c√≥ hai c·∫°nh k·ªÅ b·∫±ng nhau s·∫Ω c√≥ c·∫£ 4 c·∫°nh b·∫±ng nhau, do ƒë√≥ l√† h√¨nh vu√¥ng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 15,
        level: "Th√¥ng hi·ªÉu",
        question: "H√¨nh thoi c√≥ m·ªôt g√≥c vu√¥ng th√¨ ƒë√≥ l√†:",
        options: [
          "H√¨nh ch·ªØ nh·∫≠t",
          "HÔøΩÔøΩnh vu√¥ng",
          "H√¨nh b√¨nh h√†nh",
          "Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c"
        ],
        correct: 1,
        explanation: "H√¨nh thoi c√≥ m·ªôt g√≥c vu√¥ng th√¨ t·∫•t c·∫£ c√°c g√≥c ƒë·ªÅu vu√¥ng, k·∫øt h·ª£p v·ªõi 4 c·∫°nh b·∫±ng nhau n√™n l√† h√¨nh vu√¥ng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 16,
        level: "Th√¥ng hi·ªÉu",
        question: "T·ª© gi√°c c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng l√†:",
        options: [
          "H√¨nh thang c√¢n",
          "H√¨nh b√¨nh h√†nh",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi"
        ],
        correct: 2,
        explanation: "ƒê√¢y l√† d·∫•u hi·ªáu nh·∫≠n bi·∫øt h√¨nh ch·ªØ nh·∫≠t: hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/><line x1="40" y1="30" x2="160" y2="90" stroke="#3b82f6" stroke-width="2"/><line x1="160" y1="30" x2="40" y2="90" stroke="#3b82f6" stroke-width="2"/><circle cx="100" cy="60" r="4" fill="#ef4444"/></svg>`
      },
      {
        id: 17,
        level: "Th√¥ng hi·ªÉu",
        question: "T·ª© gi√°c c√≥ hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng l√†:",
        options: [
          "H√¨nh b√¨nh h√†nh",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi",
          "H√¨nh vu√¥ng"
        ],
        correct: 2,
        explanation: "ƒê√¢y l√† d·∫•u hi·ªáu nh·∫≠n bi·∫øt h√¨nh thoi: hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><polygon points="100,20 170,70 100,120 30,70" fill="none" stroke="currentColor" stroke-width="2"/><line x1="100" y1="20" x2="100" y2="120" stroke="#3b82f6" stroke-width="2"/><line x1="30" y1="70" x2="170" y2="70" stroke="#ef4444" stroke-width="2"/><circle cx="100" cy="70" r="4" fill="#10b981"/></svg>`
      },
      {
        id: 18,
        level: "Th√¥ng hi·ªÉu",
        question: "Trong c√°c h√¨nh sau, h√¨nh n√†o KH√îNG ph·∫£i l√† h√¨nh b√¨nh h√†nh ƒë·∫∑c bi·ªát?",
        options: [
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi",
          "H√¨nh vu√¥ng",
          "H√¨nh thang c√¢n"
        ],
        correct: 3,
        explanation: "H√¨nh thang c√¢n kh√¥ng ph·∫£i l√† h√¨nh b√¨nh h√†nh v√¨ ch·ªâ c√≥ 1 c·∫∑p c·∫°nh song song. Ba h√¨nh kia ƒë·ªÅu l√† h√¨nh b√¨nh h√†nh ƒë·∫∑c bi·ªát.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="60,20 140,20 160,100 40,100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 19,
        level: "Th√¥ng hi·ªÉu",
        question: "H√¨nh b√¨nh h√†nh c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau l√†:",
        options: [
          "H√¨nh thoi",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh vu√¥ng",
          "C·∫£ B v√† C"
        ],
        correct: 3,
        explanation: "H√¨nh b√¨nh h√†nh c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau l√† h√¨nh ch·ªØ nh·∫≠t. H√¨nh vu√¥ng c≈©ng c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau n√™n c·∫£ B v√† C ƒë·ªÅu ƒë√∫ng.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/><line x1="40" y1="30" x2="160" y2="90" stroke="#3b82f6" stroke-width="2"/><line x1="160" y1="30" x2="40" y2="90" stroke="#3b82f6" stroke-width="2"/></svg>`
      },
      {
        id: 20,
        level: "Th√¥ng hi·ªÉu",
        question: "ƒêi·ªÅu ki·ªán n√†o sau ƒë√¢y KH√îNG ƒë·ªß ƒë·ªÉ k·∫øt lu·∫≠n t·ª© gi√°c l√† h√¨nh vu√¥ng?",
        options: [
          "H√¨nh ch·ªØ nh·∫≠t c√≥ hai c·∫°nh k·ªÅ b·∫±ng nhau",
          "H√¨nh thoi c√≥ m·ªôt g√≥c vu√¥ng",
          "H√¨nh b√¨nh h√†nh c√≥ m·ªôt g√≥c vu√¥ng v√† hai c·∫°nh k·ªÅ b·∫±ng nhau",
          "H√¨nh thang c√¢n c√≥ b·ªën c·∫°nh b·∫±ng nhau"
        ],
        correct: 3,
        explanation: "H√¨nh thang c√¢n c√≥ b·ªën c·∫°nh b·∫±ng nhau ch∆∞a ƒë·ªß ƒë·ªÉ k·∫øt lu·∫≠n l√† h√¨nh vu√¥ng. Ba ƒëi·ªÅu ki·ªán c√≤n l·∫°i ƒë·ªÅu ƒëÔøΩÔøΩ.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><polygon points="50,20 150,20 165,100 35,100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },

      // V·∫¨N D·ª§NG (10 c√¢u)
      {
        id: 21,
        level: "V·∫≠n d·ª•ng",
        question: "Cho t·ª© gi√°c ABCD c√≥ AB // CD, AC = BD. ƒê·ªÉ ABCD l√† h√¨nh thang c√¢n, c·∫ßn th√™m ƒëi·ªÅu ki·ªán n√†o?",
        options: [
          "AB = CD",
          "AD = BC",
          "‚à†A = ‚à†B",
          "C·∫£ B v√† C"
        ],
        correct: 3,
        explanation: "ƒê·ªÉ l√† h√¨nh thang c√¢n, c·∫ßn th√™m AD = BC (hai c·∫°nh b√™n b·∫±ng nhau) ho·∫∑c ‚à†A = ‚à†B (hai g√≥c k·ªÅ ƒë√°y b·∫±ng nhau).",
        diagram: `<svg viewBox="0 0 200 130" class="w-full max-w-xs mx-auto"><polygon points="50,20 150,20 170,100 30,100" fill="none" stroke="currentColor" stroke-width="2"/><line x1="50" y1="20" x2="170" y2="100" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="3,3"/><line x1="150" y1="20" x2="30" y2="100" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="3,3"/></svg>`
      },
      {
        id: 22,
        level: "V·∫≠n d·ª•ng",
        question: "H√¨nh b√¨nh h√†nh ABCD c√≥ AC ‚ä• BD. V·∫≠y ABCD l√† h√¨nh g√¨?",
        options: [
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi",
          "H√¨nh vu√¥ng",
          "Ch∆∞a ƒë·ªß d·ªØ ki·ªán"
        ],
        correct: 1,
        explanation: "H√¨nh b√¨nh h√†nh c√≥ hai ƒë∆∞·ªùng ch√©o vu√¥ng g√≥c l√† h√¨nh thoi (d·∫•u hi·ªáu nh·∫≠n bi·∫øt h√¨nh thoi).",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><polygon points="100,20 170,70 100,120 30,70" fill="none" stroke="currentColor" stroke-width="2"/><line x1="100" y1="20" x2="100" y2="120" stroke="#3b82f6" stroke-width="2"/><line x1="30" y1="70" x2="170" y2="70" stroke="#ef4444" stroke-width="2"/><circle cx="100" cy="70" r="4" fill="#10b981"/></svg>`
      },
      {
        id: 23,
        level: "V·∫≠n d·ª•ng",
        question: "Cho h√¨nh thoi MNPQ c√≥ ‚à†M = 90¬∞. K·∫øt lu·∫≠n n√†o ƒë√∫ng?",
        options: [
          "MNPQ l√† h√¨nh vu√¥ng",
          "MNPQ l√† h√¨nh ch·ªØ nh·∫≠t",
          "MNPQ v·∫´n ch·ªâ l√† h√¨nh thoi",
          "Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c"
        ],
        correct: 0,
        explanation: "H√¨nh thoi c√≥ m·ªôt g√≥c vu√¥ng th√¨ t·∫•t c·∫£ c√°c g√≥c ƒë·ªÅu vu√¥ng, k·∫øt h·ª£p 4 c·∫°nh b·∫±ng nhau n√™n l√† h√¨nh vu√¥ng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 24,
        level: "V·∫≠n d·ª•ng",
        question: "T·ª© gi√°c ABCD c√≥ AB = BC = CD = DA v√† AC = BD. ABCD l√† h√¨nh g√¨?",
        options: [
          "H√¨nh thoi",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh vu√¥ng",
          "H√¨nh b√¨nh h√†nh"
        ],
        correct: 2,
        explanation: "4 c·∫°nh b·∫±ng nhau ‚Üí c√≥ th·ªÉ l√† h√¨nh thoi. Th√™m AC = BD (hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau) ‚Üí l√† h√¨nh vu√¥ng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/><line x1="50" y1="30" x2="150" y2="130" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="3,3"/><line x1="150" y1="30" x2="50" y2="130" stroke="#3b82f6" stroke-width="1.5" stroke-dasharray="3,3"/></svg>`
      },
      {
        id: 25,
        level: "V·∫≠n d·ª•ng",
        question: "Cho h√¨nh ch·ªØ nh·∫≠t ABCD. G·ªçi O l√† giao ƒëi·ªÉm hai ƒë∆∞·ªùng ch√©o. Bi·∫øt OA = OB = OC = OD = 5cm. ƒê·ªô d√†i ƒë∆∞·ªùng ch√©o l√†:",
        options: ["5cm", "10cm", "15cm", "20cm"],
        correct: 1,
        explanation: "V√¨ O l√† trung ƒëi·ªÉm c·ªßa AC n√™n AC = 2 √ó OA = 2 √ó 5 = 10cm. T∆∞∆°ng t·ª± BD = 10cm.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/><line x1="40" y1="30" x2="160" y2="90" stroke="#3b82f6" stroke-width="2"/><line x1="160" y1="30" x2="40" y2="90" stroke="#3b82f6" stroke-width="2"/><circle cx="100" cy="60" r="4" fill="#ef4444"/></svg>`
      },
      {
        id: 26,
        level: "V·∫≠n d·ª•ng",
        question: "H√¨nh thang ABCD (AB // CD) c√≥ ‚à†A = ‚à†B = 90¬∞ v√† AB = CD. V·∫≠y ABCD l√†:",
        options: [
          "H√¨nh thang c√¢n",
          "H√¨nh b√¨nh h√†nh",
          "H√¨nh ch·ªØ nh·∫≠t",
          "C·∫£ B v√† C"
        ],
        correct: 3,
        explanation: "C√≥ AB // CD v√† AB = CD ‚Üí h√¨nh b√¨nh h√†nh. Th√™m m·ªôt g√≥c vu√¥ng ‚Üí h√¨nh ch·ªØ nh·∫≠t. C·∫£ B v√† C ƒë·ªÅu ƒë√∫ng.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 27,
        level: "V·∫≠n d·ª•ng",
        question: "Cho t·ª© gi√°c MNPQ c√≥ MN = NP = PQ = QM v√† MN ‚ä• NP. H·ªèi MNPQ l√† h√¨nh g√¨?",
        options: [
          "H√¨nh thoi",
          "H√¨nh vu√¥ng",
          "H√¨nh ch·ªØ nh·∫≠t",
          "Ch∆∞a ƒë·ªß d·ªØ ki·ªán"
        ],
        correct: 1,
        explanation: "4 c·∫°nh b·∫±ng nhau v√† m·ªôt g√≥c vu√¥ng (MN ‚ä• NP t·ª©c ‚à†N = 90¬∞) ‚Üí l√† h√¨nh vu√¥ng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      },
      {
        id: 28,
        level: "V·∫≠n d·ª•ng",
        question: "Trong h√¨nh b√¨nh h√†nh ABCD, n·∫øu ‚à†A + ‚à†B = 180¬∞ v√† AC = BD th√¨ ABCD l√†:",
        options: [
          "H√¨nh thoi",
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh vu√¥ng",
          "Kh√¥ng x√°c ƒë·ªãnh"
        ],
        correct: 1,
        explanation: "‚à†A + ‚à†B = 180¬∞ l√† t√≠nh ch·∫•t c·ªßa h√¨nh b√¨nh h√†nh (hai g√≥c k·ªÅ m·ªôt c·∫°nh b√π nhau). Th√™m AC = BD ‚Üí h√¨nh ch·ªØ nh·∫≠t.",
        diagram: `<svg viewBox="0 0 200 120" class="w-full max-w-xs mx-auto"><rect x="40" y="30" width="120" height="60" fill="none" stroke="currentColor" stroke-width="2"/><line x1="40" y1="30" x2="160" y2="90" stroke="#3b82f6" stroke-width="2"/><line x1="160" y1="30" x2="40" y2="90" stroke="#3b82f6" stroke-width="2"/></svg>`
      },
      {
        id: 29,
        level: "V·∫≠n d·ª•ng",
        question: "T·ª© gi√°c c√≥ hai ƒë∆∞·ªùng ch√©o b·∫±ng nhau, vu√¥ng g√≥c v√† c·∫Øt nhau t·∫°i trung ƒëi·ªÉm m·ªói ƒë∆∞·ªùng l√†:",
        options: [
          "H√¨nh ch·ªØ nh·∫≠t",
          "H√¨nh thoi",
          "H√¨nh vu√¥ng",
          "Kh√¥ng t·ªìn t·∫°i h√¨nh nh∆∞ v·∫≠y"
        ],
        correct: 2,
        explanation: "Hai ƒë∆∞·ªùng ch√©o c·∫Øt nhau t·∫°i trung ƒëi·ªÉm ‚Üí h√¨nh b√¨nh h√†nh. Th√™m b·∫±ng nhau ‚Üí h√¨nh ch·ªØ nh·∫≠t. Th√™m vu√¥ng g√≥c ‚Üí h√¨nh vu√¥ng.",
        diagram: `<svg viewBox="0 0 200 140" class="w-full max-w-xs mx-auto"><rect x="50" y="30" width="100" height="100" fill="none" stroke="currentColor" stroke-width="2"/><line x1="50" y1="30" x2="150" y2="130" stroke="#3b82f6" stroke-width="2"/><line x1="150" y1="30" x2="50" y2="130" stroke="#3b82f6" stroke-width="2"/><circle cx="100" cy="80" r="4" fill="#ef4444"/></svg>`
      },
      {
        id: 30,
        level: "V·∫≠n d·ª•ng",
        question: "Cho h√¨nh thang c√¢n ABCD c√≥ AB // CD, AB < CD. Bi·∫øt ‚à†A = 60¬∞. T√≠nh ‚à†C?",
        options: ["60¬∞", "90¬∞", "120¬∞", "150¬∞"],
        correct: 2,
        explanation: "Trong h√¨nh thang, hai g√≥c k·ªÅ m·ªôt c·∫°nh b√™n b√π nhau. V·∫≠y ‚à†A + ‚à†D = 180¬∞, suy ra ‚à†C = 180¬∞ - 60¬∞ = 120¬∞.",
        diagram: `<svg viewBox="0 0 200 130" class="w-full max-w-xs mx-auto"><polygon points="60,20 140,20 170,100 30,100" fill="none" stroke="currentColor" stroke-width="2"/></svg>`
      }
    ];

    const defaultConfig = {
      background_color: "#0f172a",
      surface_color: "#1e293b",
      text_color: "#f1f5f9",
      primary_action_color: "#06b6d4",
      secondary_action_color: "#8b5cf6",
      font_family: "Arial",
      font_size: 16,
      game_title: "Tr√≤ Ch∆°i √în T·∫≠p H√¨nh H·ªçc",
      game_subtitle: "30 C√¢u H·ªèi - L·ªõp 8 - Ch∆∞∆°ng Tr√¨nh K·∫øt N·ªëi Tri Th·ª©c",
      start_button_text: "B·∫Øt ƒê·∫ßu L√†m B√†i",
      submit_button_text: "N·ªôp B√†i"
    };

    let currentState = {
      screen: 'home',
      currentQuestion: 0,
      answers: {},
      explanationViewed: {},
      studentName: '',
      score: 0,
      leaderboardData: [],
      mode: 'normal',
      timeRemaining: 30,
      timerInterval: null,
      startTime: null,
      shuffledQuestions: [],
      showExplanation: false
    };

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function shuffleQuestion(question) {
      const correctAnswer = question.options[question.correct];
      const shuffledOptions = shuffleArray(question.options);
      const newCorrectIndex = shuffledOptions.indexOf(correctAnswer);
      
      return {
        ...question,
        options: shuffledOptions,
        correct: newCorrectIndex
      };
    }

    const dataHandler = {
      onDataChanged(data) {
        currentState.leaderboardData = data.sort((a, b) => b.total_score - a.total_score);
        if (currentState.screen === 'leaderboard') {
          renderApp();
        }
      }
    };

    async function initializeApp() {
      const sdkResult = await window.dataSdk.init(dataHandler);
      if (!sdkResult.isOk) {
        console.error("Failed to initialize Data SDK");
      }

      await window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          const app = document.getElementById('app');
          if (!app) return;

          const customFont = config.font_family || defaultConfig.font_family;
          const baseFontStack = 'Arial, sans-serif';
          const baseSize = config.font_size || defaultConfig.font_size;
          const backgroundColor = config.background_color || defaultConfig.background_color;
          const surfaceColor = config.surface_color || defaultConfig.surface_color;
          const textColor = config.text_color || defaultConfig.text_color;
          const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
          const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

          app.style.backgroundColor = backgroundColor;
          app.style.fontFamily = `${customFont}, ${baseFontStack}`;
          app.style.color = textColor;

          const titles = app.querySelectorAll('[data-role="title"]');
          titles.forEach(el => {
            el.style.fontSize = `${baseSize * 2}px`;
            el.style.color = textColor;
          });

          const subtitles = app.querySelectorAll('[data-role="subtitle"]');
          subtitles.forEach(el => {
            el.style.fontSize = `${baseSize * 1.125}px`;
            el.style.color = textColor;
          });

          const bodyTexts = app.querySelectorAll('[data-role="body"]');
          bodyTexts.forEach(el => {
            el.style.fontSize = `${baseSize}px`;
            el.style.color = textColor;
          });

          const smallTexts = app.querySelectorAll('[data-role="small"]');
          smallTexts.forEach(el => {
            el.style.fontSize = `${baseSize * 0.875}px`;
            el.style.color = textColor;
          });

          const surfaces = app.querySelectorAll('[data-role="surface"]');
          surfaces.forEach(el => {
            el.style.backgroundColor = surfaceColor;
          });

          const primaryButtons = app.querySelectorAll('[data-role="primary-button"]');
          primaryButtons.forEach(el => {
            el.style.backgroundColor = primaryColor;
            el.style.color = '#ffffff';
          });

          const secondaryButtons = app.querySelectorAll('[data-role="secondary-button"]');
          secondaryButtons.forEach(el => {
            el.style.backgroundColor = secondaryColor;
            el.style.color = '#ffffff';
          });

          const options = app.querySelectorAll('[data-role="option"]');
          options.forEach(el => {
            el.style.borderColor = secondaryColor;
          });

          const gameTitle = app.querySelector('[data-editable="game-title"]');
          if (gameTitle) {
            gameTitle.textContent = config.game_title || defaultConfig.game_title;
          }

          const gameSubtitle = app.querySelector('[data-editable="game-subtitle"]');
          if (gameSubtitle) {
            gameSubtitle.textContent = config.game_subtitle || defaultConfig.game_subtitle;
          }

          const startButton = app.querySelector('[data-editable="start-button"]');
          if (startButton) {
            startButton.textContent = config.start_button_text || defaultConfig.start_button_text;
          }

          const submitButton = app.querySelector('[data-editable="submit-button"]');
          if (submitButton) {
            submitButton.textContent = config.submit_button_text || defaultConfig.submit_button_text;
          }
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["game_subtitle", config.game_subtitle || defaultConfig.game_subtitle],
          ["start_button_text", config.start_button_text || defaultConfig.start_button_text],
          ["submit_button_text", config.submit_button_text || defaultConfig.submit_button_text]
        ])
      });

      renderApp();
    }

    function renderApp() {
      const app = document.getElementById('app');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

      if (currentState.screen === 'home') {
        renderHome();
      } else if (currentState.screen === 'quiz') {
        renderQuiz();
      } else if (currentState.screen === 'result') {
        renderResult();
      } else if (currentState.screen === 'leaderboard') {
        renderLeaderboard();
      } else if (currentState.screen === 'stats') {
        renderStats();
      }
    }

    function renderHome() {
      const app = document.getElementById('app');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

      app.innerHTML = `
        <div class="min-h-full flex items-center justify-center p-6">
          <div data-role="surface" class="rounded-lg shadow-xl p-8 max-w-2xl w-full text-center fade-in">
            <div class="mb-2">
              <span data-role="small" class="inline-block px-3 py-1 rounded-full" style="background-color: rgba(59, 130, 246, 0.1);">
                To√°n H√¨nh H·ªçc
              </span>
            </div>
            <h1 data-role="title" data-editable="game-title" class="font-bold mb-4">
              ${config.game_title || defaultConfig.game_title}
            </h1>
            <p data-role="subtitle" data-editable="game-subtitle" class="mb-8">
              ${config.game_subtitle || defaultConfig.game_subtitle}
            </p>
            <div class="mb-6">
              <input
                type="text"
                id="student-name"
                placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n..."
                data-role="body"
                class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2"
                style="border-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; background-color: ${config.surface_color || defaultConfig.surface_color};"
              >
              <label for="student-name" class="sr-only">T√™n h·ªçc sinh</label>
            </div>
            
            <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(59, 130, 246, 0.05);">
              <p data-role="body" class="font-semibold mb-3">Ch·ªçn ch·∫ø ƒë·ªô ch∆°i:</p>
              <div class="space-y-3">
                <button
                  id="mode-normal"
                  class="mode-btn w-full p-4 rounded-lg border-2 text-left transition-all"
                  style="border-color: ${config.primary_action_color || defaultConfig.primary_action_color}; background-color: rgba(59, 130, 246, 0.1);"
                >
                  <div class="flex items-center justify-between">
                    <div>
                      <p data-role="body" class="font-bold">üìö Ch·∫ø ƒëÔøΩÔøΩÔøΩ Th√¥ng th∆∞·ªùng</p>
                      <p data-role="small">Kh√¥ng gi·ªõi h·∫°n th·ªùi gian, t·∫≠p trung h·ªçc t·∫≠p</p>
                    </div>
                    <span class="text-2xl">‚úì</span>
                  </div>
                </button>
                <button
                  id="mode-timed"
                  class="mode-btn w-full p-4 rounded-lg border-2 text-left transition-all"
                  style="border-color: ${config.secondary_action_color || defaultConfig.secondary_action_color};"
                >
                  <div class="flex items-center justify-between">
                    <div>
                      <p data-role="body" class="font-bold">‚è±Ô∏è Ch·∫ø ƒë·ªô Th·ªùi gian</p>
                      <p data-role="small">30 gi√¢y/c√¢u, th·ª≠ th√°ch k·ªπ nƒÉng</p>
                    </div>
                  </div>
                </button>
              </div>
            </div>

            <div class="space-y-4">
              <button
                id="start-btn"
                data-role="primary-button"
                data-editable="start-button"
                class="w-full py-4 rounded-lg font-semibold transition-opacity hover:opacity-90"
              >
                ${config.start_button_text || defaultConfig.start_button_text}
              </button>
              <div class="grid grid-cols-2 gap-4">
                <button
                  id="leaderboard-btn"
                  data-role="secondary-button"
                  class="py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  üèÜ B·∫£ng X·∫øp H·∫°ng
                </button>
                <button
                  id="stats-btn"
                  data-role="secondary-button"
                  class="py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  üìä Th·ªëng K√™
                </button>
              </div>
            </div>
            <div data-role="small" class="mt-6 space-y-2">
              <p>üìä 30 c√¢u h·ªèi v·ªõi 3 c·∫•p ƒë·ªô</p>
              <p>‚úÖ Nh·∫≠n bi·∫øt ‚Ä¢ üí° Th√¥ng hi·ªÉu ‚Ä¢ üéØ V·∫≠n d·ª•ng</p>
              <p>üîÄ C√¢u h·ªèi v√† ƒë√°p √°n ƒë∆∞·ª£c x√°o tr·ªôn m·ªói l·∫ßn ch∆°i</p>
              <p>üìñ Gi·∫£i th√≠ch chi ti·∫øt sau m·ªói c√¢u h·ªèi</p>
            </div>
          </div>
        </div>
      `;

      const normalBtn = document.getElementById('mode-normal');
      const timedBtn = document.getElementById('mode-timed');
      
      function updateModeButtons() {
        const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
        if (currentState.mode === 'normal') {
          normalBtn.style.borderColor = config.primary_action_color || defaultConfig.primary_action_color;
          normalBtn.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
          normalBtn.querySelector('span').textContent = '‚úì';
          timedBtn.style.borderColor = config.secondary_action_color || defaultConfig.secondary_action_color;
          timedBtn.style.backgroundColor = 'transparent';
          timedBtn.querySelector('span') && (timedBtn.querySelector('span').textContent = '');
        } else {
          timedBtn.style.borderColor = config.primary_action_color || defaultConfig.primary_action_color;
          timedBtn.style.backgroundColor = 'rgba(239, 68, 68, 0.1)';
          if (!timedBtn.querySelector('span')) {
            timedBtn.querySelector('div').insertAdjacentHTML('beforeend', '<span class="text-2xl">‚úì</span>');
          } else {
            timedBtn.querySelector('span').textContent = '‚úì';
          }
          normalBtn.style.borderColor = config.secondary_action_color || defaultConfig.secondary_action_color;
          normalBtn.style.backgroundColor = 'transparent';
          normalBtn.querySelector('span').textContent = '';
        }
      }

      normalBtn.addEventListener('click', () => {
        currentState.mode = 'normal';
        updateModeButtons();
      });

      timedBtn.addEventListener('click', () => {
        currentState.mode = 'timed';
        updateModeButtons();
      });

      document.getElementById('start-btn').addEventListener('click', startQuiz);
      document.getElementById('leaderboard-btn').addEventListener('click', () => {
        currentState.screen = 'leaderboard';
        renderApp();
      });
      document.getElementById('stats-btn').addEventListener('click', () => {
        currentState.screen = 'stats';
        renderApp();
      });
    }

    function startQuiz() {
      const nameInput = document.getElementById('student-name');
      const name = nameInput.value.trim();
      
      if (!name) {
        const messageDiv = document.createElement('div');
        messageDiv.textContent = 'Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n!';
        messageDiv.className = 'mt-2 p-2 rounded';
        messageDiv.style.backgroundColor = '#fee2e2';
        messageDiv.style.color = '#991b1b';
        messageDiv.setAttribute('data-role', 'small');
        
        const existingMessage = nameInput.parentElement.querySelector('[data-role="small"][style*="fee2e2"]');
        if (existingMessage) {
          existingMessage.remove();
        }
        
        nameInput.parentElement.appendChild(messageDiv);
        
        setTimeout(() => messageDiv.remove(), 3000);
        return;
      }

      currentState.studentName = name;
      currentState.screen = 'quiz';
      currentState.currentQuestion = 0;
      currentState.answers = {};
      currentState.explanationViewed = {};
      currentState.startTime = Date.now();
      currentState.shuffledQuestions = questions.map(q => shuffleQuestion(q));
      
      if (currentState.mode === 'timed') {
        currentState.timeRemaining = 30;
        startTimer();
      }
      
      renderApp();
    }

    function startTimer() {
      if (currentState.timerInterval) {
        clearInterval(currentState.timerInterval);
      }
      
      currentState.timeRemaining = 30;
      currentState.timerInterval = setInterval(() => {
        currentState.timeRemaining--;
        
        const timerEl = document.getElementById('timer');
        if (timerEl) {
          timerEl.textContent = currentState.timeRemaining;
          if (currentState.timeRemaining <= 5) {
            timerEl.parentElement.classList.add('timer-warning');
          }
        }
        
        if (currentState.timeRemaining <= 0) {
          clearInterval(currentState.timerInterval);
          nextQuestion();
        }
      }, 1000);
    }

    function nextQuestion() {
      if (currentState.currentQuestion < currentState.shuffledQuestions.length - 1) {
        currentState.currentQuestion++;
        if (currentState.mode === 'timed') {
          startTimer();
        }
        renderQuiz();
      } else {
        submitQuiz();
      }
    }

    function renderQuiz() {
      const app = document.getElementById('app');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const question = currentState.shuffledQuestions[currentState.currentQuestion];
      const progress = ((currentState.currentQuestion + 1) / currentState.shuffledQuestions.length) * 100;

      const levelColors = {
        'Nh·∫≠n bi·∫øt': '#10b981',
        'Th√¥ng hi·ªÉu': '#f59e0b',
        'V·∫≠n d·ª•ng': '#ef4444'
      };

      const levelEmojis = {
        'Nh·∫≠n bi·∫øt': '‚úÖ',
        'Th√¥ng hi·ªÉu': 'üí°',
        'V·∫≠n d·ª•ng': 'üéØ'
      };

      const userAnswer = currentState.answers[question.id];
      const isAnswered = userAnswer !== undefined;
      const showExplanation = currentState.explanationViewed[question.id] === true;

      app.innerHTML = `
        <div class="min-h-full p-4">
          <div class="max-w-3xl mx-auto">
            <div class="mb-6 fade-in">
              <div class="flex justify-between items-center mb-2">
                <span data-role="body" class="font-semibold">C√¢u ${currentState.currentQuestion + 1}/${currentState.shuffledQuestions.length}</span>
                <div class="flex items-center gap-3">
                  <span data-role="small" class="px-3 py-1 rounded-full" style="background-color: ${levelColors[question.level]}20; color: ${levelColors[question.level]};">
                    ${levelEmojis[question.level]} ${question.level}
                  </span>
                  ${currentState.mode === 'timed' ? `
                    <div class="flex items-center gap-2 px-3 py-1 rounded-full ${currentState.timeRemaining <= 5 ? 'timer-warning' : ''}" style="background-color: ${currentState.timeRemaining <= 5 ? '#fee2e2' : 'rgba(100, 116, 139, 0.1)'}; color: ${currentState.timeRemaining <= 5 ? '#991b1b' : '#64748b'};">
                      <span>‚è±Ô∏è</span>
                      <span data-role="body" class="font-bold" id="timer">${currentState.timeRemaining}</span>
                    </div>
                  ` : ''}
                </div>
              </div>
              <div class="w-full h-2 rounded-full" style="background-color: rgba(100, 116, 139, 0.2);">
                <div class="h-2 rounded-full transition-all duration-300" style="width: ${progress}%; background-color: ${config.primary_action_color || defaultConfig.primary_action_color};"></div>
              </div>
            </div>

            <div data-role="surface" class="rounded-lg shadow-lg p-6 mb-6">
              <h2 data-role="subtitle" class="font-bold mb-4">${question.question}</h2>
              
              ${question.diagram ? `
                <div class="mb-6 p-4 rounded-lg" style="background-color: rgba(100, 116, 139, 0.05);">
                  ${question.diagram}
                </div>
              ` : ''}

              <div class="space-y-3">
                ${question.options.map((option, index) => {
                  const isSelected = userAnswer === index;
                  const isCorrect = index === question.correct;
                  const showCorrect = showExplanation && isCorrect;
                  const showWrong = showExplanation && isSelected && !isCorrect;
                  
                  return `
                    <button
                      class="quiz-option w-full text-left p-4 rounded-lg border-2 transition-all ${isSelected && !showExplanation ? 'selected-option' : ''} ${showExplanation ? 'cursor-default' : 'hover:shadow-md'}"
                      data-role="option"
                      data-index="${index}"
                      ${showExplanation ? 'disabled' : ''}
                      style="border-color: ${showCorrect ? '#10b981' : showWrong ? '#ef4444' : isSelected ? config.primary_action_color || defaultConfig.primary_action_color : config.secondary_action_color || defaultConfig.secondary_action_color}; background-color: ${showCorrect ? 'rgba(16, 185, 129, 0.1)' : showWrong ? 'rgba(239, 68, 68, 0.1)' : isSelected ? (config.primary_action_color || defaultConfig.primary_action_color) + '10' : 'transparent'};"
                    >
                      <span data-role="body" class="flex items-start justify-between">
                        <span class="flex items-start flex-1">
                          <span class="font-bold mr-3">${String.fromCharCode(65 + index)}.</span>
                          <span>${option}</span>
                        </span>
                        ${showCorrect ? '<span class="text-2xl ml-2">‚úÖ</span>' : ''}
                        ${showWrong ? '<span class="text-2xl ml-2">‚ùå</span>' : ''}
                      </span>
                    </button>
                  `;
                }).join('')}
              </div>

              ${showExplanation ? `
                <div class="mt-6 p-4 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1); border-left: 4px solid ${config.primary_action_color || defaultConfig.primary_action_color};">
                  <p data-role="body" class="font-bold mb-2">üí° Gi·∫£i th√≠ch:</p>
                  <p data-role="body">${question.explanation}</p>
                </div>
              ` : ''}
            </div>

            <div class="flex gap-4 flex-wrap">
              ${currentState.currentQuestion > 0 ? `
                <button
                  id="prev-btn"
                  data-role="secondary-button"
                  class="px-6 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  ‚Üê C√¢u tr∆∞·ªõc
                </button>
              ` : ''}
              
              ${!showExplanation && isAnswered ? `
                <button
                  id="check-btn"
                  data-role="secondary-button"
                  class="px-6 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  üìñ Xem Gi·∫£i Th√≠ch
                </button>
              ` : ''}

              ${isAnswered ? `
                ${currentState.currentQuestion < currentState.shuffledQuestions.length - 1 ? `
                  <button
                    id="next-btn"
                    data-role="primary-button"
                    class="flex-1 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                  >
                    C√¢u ti·∫øp theo ‚Üí
                  </button>
                ` : `
                  <button
                    id="submit-btn"
                    data-role="primary-button"
                    data-editable="submit-button"
                    class="flex-1 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                  >
                    ${config.submit_button_text || defaultConfig.submit_button_text}
                  </button>
                `}
              ` : ''}
            </div>
          </div>
        </div>
      `;

      if (!showExplanation) {
        const options = app.querySelectorAll('.quiz-option');
        options.forEach(option => {
          option.addEventListener('click', (e) => {
            const index = parseInt(e.currentTarget.dataset.index);
            currentState.answers[question.id] = index;
            
            if (currentState.mode === 'timed') {
              clearInterval(currentState.timerInterval);
            }
            
            renderQuiz();
          });
        });
      }

      const prevBtn = document.getElementById('prev-btn');
        if (prevBtn) {
          prevBtn.addEventListener('click', () => {
            if (currentState.mode === 'timed') {
              clearInterval(currentState.timerInterval);
            }
            currentState.currentQuestion--;
            if (currentState.mode === 'timed') {
              startTimer();
            }
            renderQuiz();
          });
        }
      }

      const checkBtn = document.getElementById('check-btn');
      if (checkBtn) {
        checkBtn.addEventListener('click', () => {
          if (currentState.mode === 'timed') {
            clearInterval(currentState.timerInterval);
          }
          currentState.explanationViewed[question.id] = true;
          renderQuiz();
        });
      }

      const nextBtn = document.getElementById('next-btn');
      if (nextBtn) {
        nextBtn.addEventListener('click', nextQuestion);
      }

      const submitBtn = document.getElementById('submit-btn');
      if (submitBtn) {
        submitBtn.addEventListener('click', submitQuiz);
      }
    }

    async function submitQuiz() {
      if (currentState.timerInterval) {
        clearInterval(currentState.timerInterval);
      }

      if (Object.keys(currentState.answers).length < currentState.shuffledQuestions.length) {
        const unanswered = currentState.shuffledQuestions.length - Object.keys(currentState.answers).length;
        const confirmDiv = document.createElement('div');
        confirmDiv.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50';
        confirmDiv.style.backgroundColor = '#fef3c7';
        confirmDiv.style.color = '#92400e';
        confirmDiv.innerHTML = `
          <p data-role="body" class="font-semibold mb-2">B·∫°n ch∆∞a tr·∫£ l·ªùi h·∫øt c√°c c√¢u h·ªèi!</p>
          <p data-role="small">C√≤n ${unanswered} c√¢u ch∆∞a tr·∫£ l·ªùi s·∫Ω b·ªã t√≠nh l√† sai.</p>
          <div class="mt-3 flex gap-2">
            <button id="confirm-submit" class="px-4 py-2 rounded" style="background-color: #92400e; color: white;">N·ªôp b√†i</button>
            <button id="cancel-submit" class="px-4 py-2 rounded" style="background-color: #d97706; color: white;">Quay l·∫°i</button>
          </div>
        `;
        document.body.appendChild(confirmDiv);
        
        document.getElementById('confirm-submit').addEventListener('click', () => {
          confirmDiv.remove();
          finalizeSubmit();
        });
        
        document.getElementById('cancel-submit').addEventListener('click', () => {
          confirmDiv.remove();
        });
        return;
      }

      finalizeSubmit();
    }

    async function finalizeSubmit() {
      const app = document.getElementById('app');
      const loadingDiv = document.createElement('div');
      loadingDiv.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50';
      loadingDiv.style.backgroundColor = '#3b82f6';
      loadingDiv.style.color = 'white';
      loadingDiv.innerHTML = '<p data-role="body">ƒêang t√≠nh ƒëi·ªÉm...</p>';
      app.appendChild(loadingDiv);

      let correct = 0;
      currentState.shuffledQuestions.forEach(q => {
        if (currentState.answers[q.id] === q.correct) {
          correct++;
        }
      });

      const timeTaken = Math.floor((Date.now() - currentState.startTime) / 1000);
      currentState.score = correct;
      currentState.screen = 'result';

      const result = await window.dataSdk.create({
        student_name: currentState.studentName,
        total_score: correct,
        correct_answers: correct,
        completed_at: new Date().toISOString(),
        time_taken: timeTaken,
        mode: currentState.mode
      });

      loadingDiv.remove();

      if (!result.isOk) {
        const errorDiv = document.createElement('div');
        errorDiv.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50';
        errorDiv.style.backgroundColor = '#fee2e2';
        errorDiv.style.color = '#991b1b';
        errorDiv.innerHTML = `<p data-role="body">Kh√¥ng th·ªÉ l∆∞u k·∫øt qu·∫£. Vui l√≤ng th·ª≠ l·∫°i.</p>`;
        app.appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 3000);
      }

      renderApp();
    }

    function renderResult() {
      const app = document.getElementById('app');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const percentage = (currentState.score / currentState.shuffledQuestions.length) * 100;
      
      let grade, message, emoji;
      if (percentage >= 90) {
        grade = "Xu·∫•t s·∫Øc";
        message = "B·∫°n ƒë√£ n·∫Øm v·ªØng ki·∫øn th·ª©c!";
        emoji = "üèÜ";
      } else if (percentage >= 75) {
        grade = "Gi·ªèi";
        message = "B·∫°n l√†m b√†i r·∫•t t·ªët!";
        emoji = "üåü";
      } else if (percentage >= 60) {
        grade = "Kh√°";
        message = "B·∫°n c·∫ßn √¥n t·∫≠p th√™m m·ªôt ch√∫t!";
        emoji = "üëç";
      } else if (percentage >= 40) {
        grade = "Trung b√¨nh";
        message = "H√£y c·ªë g·∫Øng √¥n t·∫≠p nhi·ªÅu h∆°n!";
        emoji = "üìö";
      } else {
        grade = "Y·∫øu";
        message = "B·∫°n c·∫ßn h·ªçc l·∫°i ki·∫øn th·ª©c!";
        emoji = "üí™";
      }

      const detailedResults = currentState.shuffledQuestions.map(q => ({
        question: q,
        userAnswer: currentState.answers[q.id],
        isCorrect: currentState.answers[q.id] === q.correct
      }));

      const correctByLevel = {
        'Nh·∫≠n bi·∫øt': 0,
        'Th√¥ng hi·ªÉu': 0,
        'V·∫≠n d·ª•ng': 0
      };

      const totalByLevel = {
        'Nh·∫≠n bi·∫øt': 0,
        'Th√¥ng hi·ªÉu': 0,
        'V·∫≠n d·ª•ng': 0
      };

      detailedResults.forEach(r => {
        totalByLevel[r.question.level]++;
        if (r.isCorrect) {
          correctByLevel[r.question.level]++;
        }
      });

      const timeTaken = Math.floor((Date.now() - currentState.startTime) / 1000);
      const minutes = Math.floor(timeTaken / 60);
      const seconds = timeTaken % 60;

      app.innerHTML = `
        <div class="min-h-full p-4">
          <div class="max-w-4xl mx-auto">
            <div data-role="surface" class="rounded-lg shadow-xl p-8 mb-6 text-center celebrate">
              <div class="text-6xl mb-4">${emoji}</div>
              <h1 data-role="title" class="font-bold mb-2">${grade}</h1>
              <p data-role="subtitle" class="mb-6">${message}</p>
              
              <div class="inline-block px-8 py-4 rounded-lg mb-6" style="background-color: ${config.primary_action_color || defaultConfig.primary_action_color}20;">
                <p data-role="body" class="mb-2">K·∫øt qu·∫£ c·ªßa <span class="font-bold">${currentState.studentName}</span></p>
                <p data-role="title" class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">
                  ${currentState.score}/${currentState.shuffledQuestions.length}
                </p>
                <p data-role="body">${percentage.toFixed(1)}%</p>
                <p data-role="small" class="mt-2">‚è±Ô∏è Th·ªùi gian: ${minutes}:${seconds.toString().padStart(2, '0')}</p>
                <p data-role="small">üéÆ Ch·∫ø ƒë·ªô: ${currentState.mode === 'timed' ? 'Th·ªùi gian' : 'Th√¥ng th∆∞·ªùng'}</p>
              </div>

              <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="p-4 rounded-lg" style="background-color: rgba(16, 185, 129, 0.1);">
                  <p data-role="small" class="mb-1">‚úÖ Nh·∫≠n bi·∫øt</p>
                  <p data-role="body" class="font-bold">${correctByLevel['Nh·∫≠n bi·∫øt']}/${totalByLevel['Nh·∫≠n bi·∫øt']}</p>
                  <p data-role="small">${((correctByLevel['Nh·∫≠n bi·∫øt']/totalByLevel['Nh·∫≠n bi·∫øt'])*100).toFixed(0)}%</p>
                </div>
                <div class="p-4 rounded-lg" style="background-color: rgba(245, 158, 11, 0.1);">
                  <p data-role="small" class="mb-1">üí° Th√¥ng hi·ªÉu</p>
                  <p data-role="body" class="font-bold">${correctByLevel['Th√¥ng hi·ªÉu']}/${totalByLevel['Th√¥ng hi·ªÉu']}</p>
                  <p data-role="small">${((correctByLevel['Th√¥ng hi·ªÉu']/totalByLevel['Th√¥ng hi·ªÉu'])*100).toFixed(0)}%</p>
                </div>
                <div class="p-4 rounded-lg" style="background-color: rgba(239, 68, 68, 0.1);">
                  <p data-role="small" class="mb-1">üéØ V·∫≠n d·ª•ng</p>
                  <p data-role="body" class="font-bold">${correctByLevel['V·∫≠n d·ª•ng']}/${totalByLevel['V·∫≠n d·ª•ng']}</p>
                  <p data-role="small">${((correctByLevel['V·∫≠n d·ª•ng']/totalByLevel['V·∫≠n d·ª•ng'])*100).toFixed(0)}%</p>
                </div>
              </div>

              <div class="flex gap-4 justify-center flex-wrap">
                <button
                  id="review-btn"
                  data-role="primary-button"
                  class="px-6 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  üìù Xem Chi Ti·∫øt
                </button>
                <button
                  id="leaderboard-result-btn"
                  data-role="secondary-button"
                  class="px-6 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  üèÜ B·∫£ng X·∫øp H·∫°ng
                </button>
                <button
                  id="retry-btn"
                  data-role="secondary-button"
                  class="px-6 py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
                >
                  üîÑ L√†m L·∫°i
                </button>
              </div>
            </div>

            <div id="detailed-results" class="space-y-4" style="display: none;">
              ${detailedResults.map((r, index) => `
                <div data-role="surface" class="rounded-lg p-4 border-l-4 fade-in" style="border-color: ${r.isCorrect ? '#10b981' : '#ef4444'};">
                  <div class="flex items-start justify-between mb-2">
                    <p data-role="body" class="font-semibold flex-1">C√¢u ${index + 1}: ${r.question.question}</p>
                    <span class="text-2xl ml-2">${r.isCorrect ? '‚úÖ' : '‚ùå'}</span>
                  </div>
                  
                  ${r.question.diagram ? `
                    <div class="mb-4 p-3 rounded-lg" style="background-color: rgba(100, 116, 139, 0.05);">
                      ${r.question.diagram}
                    </div>
                  ` : ''}

                  <div class="space-y-2 mb-3">
                    ${r.question.options.map((opt, optIndex) => `
                      <div class="p-2 rounded ${optIndex === r.question.correct ? 'font-semibold' : ''}" 
                           style="background-color: ${optIndex === r.question.correct ? 'rgba(16, 185, 129, 0.1)' : optIndex === r.userAnswer && !r.isCorrect ? 'rgba(239, 68, 68, 0.1)' : 'transparent'};">
                        <span data-role="small">
                          ${String.fromCharCode(65 + optIndex)}. ${opt}
                          ${optIndex === r.question.correct ? ' ÔøΩÔøΩ ƒê√°p √°n ƒë√∫ng' : ''}
                          ${optIndex === r.userAnswer && !r.isCorrect ? ' ‚úó B·∫°n ƒë√£ ch·ªçn' : ''}
                          ${r.userAnswer === undefined && optIndex === 0 ? ' (Kh√¥ng tr·∫£ l·ªùi)' : ''}
                        </span>
                      </div>
                    `).join('')}
                  </div>

                  <div class="p-3 rounded-lg" style="background-color: rgba(59, 130, 246, 0.1);">
                    <p data-role="small" class="font-bold mb-1">üí° Gi·∫£i th√≠ch:</p>
                    <p data-role="small">${r.question.explanation}</p>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      document.getElementById('review-btn').addEventListener('click', () => {
        const detailsDiv = document.getElementById('detailed-results');
        if (detailsDiv.style.display === 'none') {
          detailsDiv.style.display = 'block';
          document.getElementById('review-btn').textContent = 'üîº ·∫®n Chi Ti·∫øt';
          detailsDiv.scrollIntoView({ behavior: 'smooth' });
        } else {
          detailsDiv.style.display = 'none';
          document.getElementById('review-btn').textContent = 'üìù Xem Chi Ti·∫øt';
        }
      });

      document.getElementById('leaderboard-result-btn').addEventListener('click', () => {
        currentState.screen = 'leaderboard';
        renderApp();
      });
      
      document.getElementById('retry-btn').addEventListener('click', () => {
        currentState.screen = 'home';
        currentState.currentQuestion = 0;
        currentState.answers = {};
        currentState.score = 0;
        renderApp();
      });
    }

    function renderLeaderboard() {
      const app = document.getElementById('app');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

      app.innerHTML = `
        <div class="min-h-full p-4">
          <div class="max-w-3xl mx-auto">
            <div data-role="surface" class="rounded-lg shadow-xl p-6 mb-6 fade-in">
              <div class="text-center mb-6">
                <div class="text-4xl mb-2">üèÜ</div>
                <h1 data-role="title" class="font-bold mb-2">B·∫£ng X·∫øp H·∫°ng</h1>
                <p data-role="body">Top h·ªçc sinh xu·∫•t s·∫Øc</p>
              </div>

              ${currentState.leaderboardData.length === 0 ? `
                <div class="text-center py-12">
                  <p data-role="body" class="mb-4">Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o!</p>
                  <p data-role="small">H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n l√†m b√†i nh√© üéØ</p>
                </div>
              ` : `
                <div class="space-y-3">
                  ${currentState.leaderboardData.slice(0, 10).map((entry, index) => {
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const percentage = (entry.total_score / questions.length) * 100;
                    const minutes = Math.floor(entry.time_taken / 60);
                    const seconds = entry.time_taken % 60;
                    return `
                      <div class="flex items-center p-4 rounded-lg transition-all hover:shadow-md" 
                           style="background-color: ${index < 3 ? 'rgba(59, 130, 246, 0.05)' : 'transparent'}; border: 2px solid ${index < 3 ? config.primary_action_color || defaultConfig.primary_action_color : config.secondary_action_color || defaultConfig.secondary_action_color}20;">
                        <span class="text-2xl mr-4 w-10">${index < 3 ? medals[index] : `#${index + 1}`}</span>
                        <div class="flex-1">
                          <p data-role="body" class="font-bold">${entry.student_name}</p>
                          <p data-role="small">${new Date(entry.completed_at).toLocaleDateString('vi-VN')} ‚Ä¢ ${entry.mode === 'timed' ? '‚è±Ô∏è Th·ªùi gian' : 'üìö Th√¥ng th∆∞·ªùng'}</p>
                          <p data-role="small">‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}</p>
                        </div>
                        <div class="text-right">
                          <p data-role="body" class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">
                            ${entry.total_score}/${questions.length}
                          </p>
                          <p data-role="small">${percentage.toFixed(1)}%</p>
                        </div>
                      </div>
                    `;
                  }).join('')}
                </div>
              `}
            </div>

            <button
              id="back-btn"
              data-role="secondary-button"
              class="w-full py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
            >
              ‚Üê Quay L·∫°i
            </button>
          </div>
        </div>
      `;

      document.getElementById('back-btn').addEventListener('click', () => {
        currentState.screen = 'home';
        renderApp();
      });
    }

    function renderStats() {
      const app = document.getElementById('app');
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;

      const myScores = currentState.leaderboardData.filter(entry => 
        entry.student_name === currentState.studentName
      );

      let avgScore = 0;
      let bestScore = 0;
      let totalAttempts = myScores.length;
      let avgTime = 0;

      if (myScores.length > 0) {
        avgScore = myScores.reduce((sum, entry) => sum + entry.total_score, 0) / myScores.length;
        bestScore = Math.max(...myScores.map(entry => entry.total_score));
        avgTime = myScores.reduce((sum, entry) => sum + entry.time_taken, 0) / myScores.length;
      }

      const recentScores = myScores.slice(0, 5);

      app.innerHTML = `
        <div class="min-h-full p-4">
          <div class="max-w-4xl mx-auto">
            <div data-role="surface" class="rounded-lg shadow-xl p-6 mb-6 fade-in">
              <div class="text-center mb-6">
                <div class="text-4xl mb-2">üìä</div>
                <h1 data-role="title" class="font-bold mb-2">Th·ªëng K√™ Ti·∫øn B·ªô</h1>
                <p data-role="body">Theo d√µi k·∫øt qu·∫£ h·ªçc t·∫≠p c·ªßa b·∫°n</p>
              </div>

              ${myScores.length === 0 ? `
                <div class="text-center py-12">
                  <p data-role="body" class="mb-4">B·∫°n ch∆∞a c√≥ k·∫øt qu·∫£ n√†o!</p>
                  <p data-role="small">H√£y b·∫Øt ƒë·∫ßu l√†m b√†i ƒë·ªÉ xem th·ªëng k√™ nh√© üìö</p>
                </div>
              ` : `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                  <div class="p-4 rounded-lg text-center" style="background-color: rgba(59, 130, 246, 0.1);">
                    <p data-role="small" class="mb-1">S·ªë l·∫ßn l√†m</p>
                    <p data-role="title" class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">${totalAttempts}</p>
                  </div>
                  <div class="p-4 rounded-lg text-center" style="background-color: rgba(16, 185, 129, 0.1);">
                    <p data-role="small" class="mb-1">ƒêi·ªÉm cao nh·∫•t</p>
                    <p data-role="title" class="font-bold" style="color: #10b981;">${bestScore}/${questions.length}</p>
                  </div>
                  <div class="p-4 rounded-lg text-center" style="background-color: rgba(245, 158, 11, 0.1);">
                    <p data-role="small" class="mb-1">ƒêi·ªÉm TB</p>
                    <p data-role="title" class="font-bold" style="color: #f59e0b;">${avgScore.toFixed(1)}</p>
                  </div>
                  <div class="p-4 rounded-lg text-center" style="background-color: rgba(139, 92, 246, 0.1);">
                    <p data-role="small" class="mb-1">Th·ªùi gian TB</p>
                    <p data-role="title" class="font-bold" style="color: #8b5cf6;">${Math.floor(avgTime/60)}:${(Math.floor(avgTime)%60).toString().padStart(2,'0')}</p>
                  </div>
                </div>

                <div class="mb-6">
                  <h2 data-role="subtitle" class="font-bold mb-4">üìà Bi·ªÉu ƒê·ªì Ti·∫øn B·ªô</h2>
                  <div class="p-4 rounded-lg" style="background-color: rgba(100, 116, 139, 0.05);">
                    <div class="space-y-3">
                      ${recentScores.reverse().map((entry, index) => {
                        const percentage = (entry.total_score / questions.length) * 100;
                        return `
                          <div>
                            <div class="flex justify-between mb-1">
                              <span data-role="small">L·∫ßn ${recentScores.length - index}</span>
                              <span data-role="small" class="font-bold">${entry.total_score}/${questions.length} (${percentage.toFixed(0)}%)</span>
                            </div>
                            <div class="w-full h-4 rounded-full" style="background-color: rgba(100, 116, 139, 0.2);">
                              <div class="h-4 rounded-full transition-all" style="width: ${percentage}%; background-color: ${percentage >= 80 ? '#10b981' : percentage >= 60 ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                          </div>
                        `;
                      }).join('')}
                    </div>
                  </div>
                </div>

                <div>
                  <h2 data-role="subtitle" class="font-bold mb-4">üìù L·ªãch S·ª≠ G·∫ßn ƒê√¢y</h2>
                  <div class="space-y-3">
                    ${myScores.slice(0, 5).map((entry, index) => {
                      const percentage = (entry.total_score / questions.length) * 100;
                      const minutes = Math.floor(entry.time_taken / 60);
                      const seconds = entry.time_taken % 60;
                      return `
                        <div class="p-4 rounded-lg border-2" style="border-color: ${config.secondary_action_color || defaultConfig.secondary_action_color}20; background-color: transparent;">
                          <div class="flex justify-between items-start">
                            <div>
                              <p data-role="body" class="font-bold mb-1">${new Date(entry.completed_at).toLocaleDateString('vi-VN')}</p>
                              <p data-role="small">${new Date(entry.completed_at).toLocaleTimeString('vi-VN')} ‚Ä¢ ${entry.mode === 'timed' ? '‚è±Ô∏è Th·ªùi gian' : 'üìö Th√¥ng th∆∞·ªùng'}</p>
                              <p data-role="small">‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}</p>
                            </div>
                            <div class="text-right">
                              <p data-role="body" class="font-bold" style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">
                                ${entry.total_score}/${questions.length}
                              </p>
                              <p data-role="small">${percentage.toFixed(1)}%</p>
                            </div>
                          </div>
                        </div>
                      `;
                    }).join('')}
                  </div>
                </div>
              `}
            </div>

            <button
              id="back-btn"
              data-role="secondary-button"
              class="w-full py-3 rounded-lg font-semibold transition-opacity hover:opacity-90"
            >
              ‚Üê Quay L·∫°i
            </button>
          </div>
        </div>
      `;

      document.getElementById('back-btn').addEventListener('click', () => {
        currentState.screen = 'home';
        renderApp();
      });
    }

    initializeApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b635781a6e8079e',t:'MTc2NzExNjYzMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>